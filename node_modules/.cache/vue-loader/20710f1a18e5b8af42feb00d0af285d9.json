{"remainingRequest":"/Users/yang77/Desktop/h5-exam/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yang77/Desktop/h5-exam/src/views/ExamDetails.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yang77/Desktop/h5-exam/src/views/ExamDetails.vue","mtime":1585408941705},{"path":"/Users/yang77/Desktop/h5-exam/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yang77/Desktop/h5-exam/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yang77/Desktop/h5-exam/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yang77/Desktop/h5-exam/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgc3R1SWQ6IG51bGwsCiAgICAgIGV4YW1OYW1lOiBudWxsLAogICAgICBlbmRUaW1lOiAzMCAqIDYwLAogICAgICBlbmRUaW1lU2hvdzogbnVsbCwKICAgICAgdG9waWNMaXN0OiBbXQogICAgfQogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuZXhhbU5hbWUgPSB0aGlzLiRyb3V0ZS5xdWVyeS5leGFtTmFtZQogICAgdGhpcy5zdHVJZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzdHVJZCcpCiAgICBkb2N1bWVudC50aXRsZSA9IHRoaXMuZXhhbU5hbWUKICAgIHRoaXMuY291bnREb3duKCkKICB9LAogIG1ldGhvZHM6IHsKICAgIGdldEV4YW1MaXN0KCkgewogICAgICB0aGlzLiRhamF4LmdldChgL2htdS9nZXRQYXBlckJ5RXhhbS8ke3RoaXMuZXhhbU5hbWV9YCkudGhlbihyZXMgPT4gewogICAgICAgIGlmIChyZXMucmVzdWx0ID09PSAwKSB7CiAgICAgICAgICB0aGlzLnRvcGljTGlzdCA9IHJlcy5kYXRhLnNlbGVjdC5xdWVzdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kdG9hc3QudGV4dChyZXMuZXJyTXNnKQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICBzdGFydEV4YW0oKSB7CiAgICAgIHRoaXMuJGFqYXgKICAgICAgICAuZ2V0KGAvaG11L2dldFRpbWUvJHt0aGlzLmV4YW1OYW1lfS8ke3RoaXMuc3R1SWR9YCkKICAgICAgICAudGhlbihyZXMgPT4gewogICAgICAgICAgaWYgKHJlcy5yZXN1bHQgPT09IDApIHsKICAgICAgICAgICAgbGV0IHRpbWUgPSByZXMuZGF0YS5kdXJpbmcKICAgICAgICAgICAgaWYgKHRpbWUgPiAwKSB7CiAgICAgICAgICAgICAgdGhpcy4kdG9hc3QudGV4dCgn6ICD6K+V5pyq5byA5aeLJykKICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gJy8jL2V4YW1saXN0JwogICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aW1lIDwgLTE4MDApIHsKICAgICAgICAgICAgICB0aGlzLiR0b2FzdC50ZXh0KCfogIPor5Xlt7Lnu5PmnZ8nKQogICAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSAnLyMvZXhhbWxpc3QnCiAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5nZXRFeGFtTGlzdCgpCiAgICAgICAgICAgIHRoaXMuZW5kVGltZSA9IHRoaXMuZW5kVGltZSArIHRpbWUKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuJHRvYXN0LnRleHQocmVzLmVyck1zZykKICAgICAgICAgIH0KICAgICAgICB9KQogICAgfSwKICAgIHN1Ym1pdCgpIHsKICAgICAgbGV0IHBvc3REYXRhID0gewogICAgICAgIHNjb3JlOiAwLAogICAgICAgIGFuc3dlcjogW10sCiAgICAgICAgcXVlc3Rpb25JZDogW10sCiAgICAgICAgaXNSaWdodDogW10sCiAgICAgICAgc3R1SWQ6IHRoaXMuc3R1SWQsCiAgICAgICAgZXhhbU5hbWU6IHRoaXMuZXhhbU5hbWUKICAgICAgfQogICAgICB0aGlzLnRvcGljTGlzdC5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgIHBvc3REYXRhLmFuc3dlci5wdXNoKGl0ZW0uc3R1QW5zd2VyKQogICAgICAgIHBvc3REYXRhLnF1ZXN0aW9uSWQucHVzaChpdGVtLnF1ZXN0aW9uSWQpCiAgICAgICAgaWYgKGl0ZW0ucmlnaHRBbnN3ZXIgPT09IGl0ZW0uc3R1QW5zd2VyKSB7CiAgICAgICAgICBwb3N0RGF0YS5zY29yZSArPSA1CiAgICAgICAgICBwb3N0RGF0YS5pc1JpZ2h0LnB1c2goMSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcG9zdERhdGEuaXNSaWdodC5wdXNoKDApCiAgICAgICAgfQogICAgICB9KQogICAgICBwb3N0RGF0YSA9IEpTT04uc3RyaW5naWZ5KHBvc3REYXRhKQogICAgICB0aGlzLiRhamF4CiAgICAgICAgLnBvc3QoYC9obXUvdXBsb2FkP3BhcmFtPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHBvc3REYXRhKX1gKQogICAgICAgIC50aGVuKHJlcyA9PiB7CiAgICAgICAgICBpZiAocmVzLnJlc3VsdCA9PT0gMCkgewogICAgICAgICAgICB0aGlzLiR0b2FzdC50ZXh0KCfmj5DkuqTmiJDlip8nKQogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IG5hbWU6ICdleGFtbGlzdCcgfSkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuJHRvYXN0LnRleHQocmVzLmVyck1zZykKICAgICAgICAgIH0KICAgICAgICB9KQogICAgfSwKICAgIGNvdW50RG93bigpIHsKICAgICAgdGhpcy5zdGFydEV4YW0oKQogICAgICBjb25zdCB0aGF0ID0gdGhpcwogICAgICBsZXQgdGltZUludCA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICB0aGF0LmVuZFRpbWUgPSB0aGF0LmVuZFRpbWUgLSAxCiAgICAgICAgdGhhdC5lbmRUaW1lU2hvdyA9CiAgICAgICAgICBNYXRoLmZsb29yKHRoYXQuZW5kVGltZSAvIDYwKSArICfliIYnICsgKHRoYXQuZW5kVGltZSAlIDYwKSArICfnp5InCiAgICAgICAgaWYgKHRoYXQuZW5kVGltZSA9PT0gMCkgewogICAgICAgICAgdGhhdC5zdWJtaXQoKQogICAgICAgIH0KICAgICAgfSwgMTAwMCkKICAgIH0KICB9Cn0K"},{"version":3,"sources":["ExamDetails.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ExamDetails.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"exam-details\">\n    <div class=\"title\">\n      {{ examName }}\n    </div>\n    <div class=\"count-down\">剩余时间: {{ endTimeShow }}</div>\n    <div class=\"description\">\n      单项选择题，每题5分，多选，错选均不得分，20题，共计100分\n    </div>\n    <div class=\"content\">\n      <div class=\"exam-item\" v-for=\"(item, index) in topicList\" :key=\"index\">\n        <div class=\"topic\">{{ index + 1 }}.{{ item.question }}</div>\n        <nut-radiogroup v-model=\"item.stuAnswer\">\n          <div>\n            <nut-radio label=\"A\">A:{{ item.a }}</nut-radio>\n          </div>\n          <div>\n            <nut-radio label=\"B\">B.{{ item.b }}</nut-radio>\n          </div>\n          <div>\n            <nut-radio label=\"C\">C.{{ item.c }}</nut-radio>\n          </div>\n          <div>\n            <nut-radio label=\"D\">D.{{ item.d }}</nut-radio>\n          </div>\n        </nut-radiogroup>\n      </div>\n    </div>\n    <div class=\"submit\">\n      <nut-button block shape=\"circle\" @click=\"submit\">\n        提交试卷\n      </nut-button>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      stuId: null,\n      examName: null,\n      endTime: 30 * 60,\n      endTimeShow: null,\n      topicList: []\n    }\n  },\n  mounted() {\n    this.examName = this.$route.query.examName\n    this.stuId = localStorage.getItem('stuId')\n    document.title = this.examName\n    this.countDown()\n  },\n  methods: {\n    getExamList() {\n      this.$ajax.get(`/hmu/getPaperByExam/${this.examName}`).then(res => {\n        if (res.result === 0) {\n          this.topicList = res.data.select.questions\n        } else {\n          this.$toast.text(res.errMsg)\n        }\n      })\n    },\n    startExam() {\n      this.$ajax\n        .get(`/hmu/getTime/${this.examName}/${this.stuId}`)\n        .then(res => {\n          if (res.result === 0) {\n            let time = res.data.during\n            if (time > 0) {\n              this.$toast.text('考试未开始')\n              location.href = '/#/examlist'\n              return\n            }\n            if (time < -1800) {\n              this.$toast.text('考试已结束')\n              location.href = '/#/examlist'\n              return\n            }\n            this.getExamList()\n            this.endTime = this.endTime + time\n          } else {\n            this.$toast.text(res.errMsg)\n          }\n        })\n    },\n    submit() {\n      let postData = {\n        score: 0,\n        answer: [],\n        questionId: [],\n        isRight: [],\n        stuId: this.stuId,\n        examName: this.examName\n      }\n      this.topicList.forEach(item => {\n        postData.answer.push(item.stuAnswer)\n        postData.questionId.push(item.questionId)\n        if (item.rightAnswer === item.stuAnswer) {\n          postData.score += 5\n          postData.isRight.push(1)\n        } else {\n          postData.isRight.push(0)\n        }\n      })\n      postData = JSON.stringify(postData)\n      this.$ajax\n        .post(`/hmu/upload?param=${encodeURIComponent(postData)}`)\n        .then(res => {\n          if (res.result === 0) {\n            this.$toast.text('提交成功')\n            this.$router.push({ name: 'examlist' })\n          } else {\n            this.$toast.text(res.errMsg)\n          }\n        })\n    },\n    countDown() {\n      this.startExam()\n      const that = this\n      let timeInt = setInterval(() => {\n        that.endTime = that.endTime - 1\n        that.endTimeShow =\n          Math.floor(that.endTime / 60) + '分' + (that.endTime % 60) + '秒'\n        if (that.endTime === 0) {\n          that.submit()\n        }\n      }, 1000)\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.exam-details {\n  .title {\n    font-size: 18px;\n    text-align: center;\n  }\n  .count-down {\n    margin: 10px;\n    text-align: right;\n  }\n  .description {\n    margin: 0 0 20px 0;\n    text-align: center;\n  }\n  .content {\n    .topic {\n      margin: 0 0 10px 0;\n    }\n    .exam-item {\n      margin: 12px;\n    }\n  }\n  .submit {\n    margin: 50px 0 40px 0;\n  }\n}\n</style>\n\n<style lang=\"less\">\n.exam-details {\n  .nut-radio-label {\n    font-size: 16px !important;\n  }\n}\n</style>\n"]}]}